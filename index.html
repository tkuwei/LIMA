<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>樹新記帳 Gemini</title>
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-capable" content="yes">

	<meta name="apple-mobile-web-app-title" content="樹新記帳 Gemini">

	<meta name="theme-color" content="#ffffff">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

	<link rel="icon" sizes="192x192" href="logo.png">
	<link rel="apple-touch-icon" href="logo.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
	<link rel="manifest" href="manifest.json">
</head>
<body class="p-2 md:p-6">

    <div id="loading" class="loading-overlay">
        <i class="fas fa-sync fa-spin text-4xl mb-3"></i>
        <span id="loading-text" class="font-bold text-xl">雲端同步中...</span>
    </div>

	<div id="toast">儲存成功</div>

    <div class="max-w-6xl mx-auto">
        <div class="flex gap-10 mb-6 bg-white p-2 rounded-2xl shadow-sm border justify-center">
            <button onclick="switchMainTab('record')" id="tab-record" class="tab-btn px-8 py-3 tab-active"><i class="fas fa-pen-nib mr-2"></i>記帳錄入</button>
            <button onclick="switchMainTab('report')" id="tab-report" class="tab-btn px-8 py-3"><i class="fas fa-chart-bar mr-2"></i>經營報表</button>
        </div>

        <div id="section-record" class="flex flex-col md:flex-row gap-6">
            <div class="w-full md:w-5/12 space-y-4">
                <div class="bg-white p-5 rounded-3xl shadow-lg border">
                    <div class="flex justify-between items-center mb-4">
                        <button onclick="prevMonth()" class="p-2 hover:bg-slate-100 rounded-full"><i class="fas fa-chevron-left"></i></button>
                        <h2 id="monthDisplay" class="text-lg font-black text-slate-700">月份</h2>
                        <button onclick="nextMonth()" class="p-2 hover:bg-slate-100 rounded-full"><i class="fas fa-chevron-right"></i></button>
                    </div>
                    <div id="calendarGrid" class="calendar-grid"></div>
                </div>
                <div class="bg-white p-5 rounded-3xl shadow-lg border">
                    <h4 class="font-black text-slate-700 mb-3 flex items-center">
                        <i class="fas fa-list-ul mr-2 text-orange-500"></i> 當日明細
                    </h4>
                    <div id="dayDetailList" class="space-y-2 max-h-60 overflow-y-auto">
                        <p class="text-slate-400 text-sm text-center py-4">載入中...</p>
                    </div>
                </div>
            </div>

            <div class="flex-1 space-y-4">
                <div id="inputCard" class="bg-white p-6 rounded-3xl shadow-lg border transition-all duration-300">
                    <div class="flex justify-between items-end mb-6">
                        <div>
                            <p class="text-slate-500 text-xs font-bold uppercase tracking-widest">Selected Date</p>
                            <h3 id="displaySelectedDate" class="text-3xl font-black text-slate-800">日期</h3>
                        </div>
                        <span id="currentStatusTag" class="px-4 py-1 rounded-full text-xs font-bold shadow-sm transition-colors">收入模式</span>
                    </div>
                    
                    <div id="editNotice" class="hidden mb-4 p-2 bg-orange-100 text-orange-700 text-sm font-bold rounded-lg text-center animate-pulse">
                        ⚠️ 正在編輯現有紀錄
                    </div>

                    <div class="grid grid-cols-2 gap-3 mb-6">
                        <button onclick="changeMode('income')" id="btn-income" class="py-4 rounded-xl font-bold shadow-md transition-all">記收入</button>
                        <button onclick="changeMode('expense')" id="btn-expense" class="py-4 rounded-xl font-bold transition-all">記支出</button>
                    </div>

                    <div class="space-y-4">
                        <select id="inputCategory" class="w-full bg-white border rounded-xl p-4 text-lg font-bold outline-none shadow-sm"></select>
                        <input type="number" id="inputAmount" inputmode="numeric" placeholder="請輸入金額" class="w-full bg-white border rounded-xl p-5 text-4xl font-black outline-none shadow-inner transition-colors">
                        <input type="text" id="inputNote" placeholder="備註..." class="w-full bg-white border rounded-xl p-4 outline-none shadow-sm">
                        
                        <div class="flex gap-2">
                            <button onclick="saveRecord()" class="flex-1 bg-slate-900 text-white font-black py-5 rounded-xl text-xl shadow-xl hover:bg-black transition active:scale-95">確認存入</button>
                            <button id="cancelEditBtn" onclick="resetForm()" class="hidden px-4 bg-slate-200 text-slate-600 font-bold rounded-xl hover:bg-slate-300 transition">取消</button>
                            <button id="deleteBtn" onclick="deleteRecord()" class="hidden px-4 bg-red-100 text-red-600 font-bold rounded-xl hover:bg-red-200 transition"><i class="fas fa-trash-alt"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="section-report" class="hidden space-y-6">
            <div class="bg-white p-5 rounded-3xl shadow border flex flex-wrap gap-4 items-center justify-between">
                <div class="flex flex-wrap gap-4 items-center">
                    <div class="flex items-center gap-2">
                        <span class="font-bold text-slate-500">年份：</span>
                        <select id="reportYearSelect" onchange="renderReports()" class="bg-slate-100 rounded-lg p-2 font-black"></select>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="font-bold text-slate-500">月份：</span>
                        <select id="reportMonthSelect" onchange="renderReports()" class="bg-slate-100 rounded-lg p-2 font-black"></select>
                    </div>
                </div>
                <div class="flex bg-slate-100 p-1 rounded-xl">
                    <button onclick="changeReportView('month')" id="view-month" class="px-4 py-2 rounded-lg font-bold transition-all bg-white shadow-sm text-orange-600">月線</button>
                    <button onclick="changeReportView('week')" id="view-week" class="px-4 py-2 rounded-lg font-bold transition-all text-slate-500">週線</button>
                    <button onclick="changeReportView('day')" id="view-day" class="px-4 py-2 rounded-lg font-bold transition-all text-slate-500">日線</button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 bg-white p-6 rounded-3xl shadow border">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-black text-slate-800 border-l-4 border-blue-500 pl-3">年度趨勢分析</h3>
                        <span id="scrollHint" class="hidden text-xs text-orange-500 animate-pulse"><i class="fas fa-arrows-alt-h"></i> 左右滑動查看全年</span>
                    </div>
                    <div style="width: 100%; overflow-x: auto; padding-bottom: 10px;">
                        <div id="chartTrendContainer" style="height: 350px; width: 100%; position: relative;">
                            <canvas id="chartTrend"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-3xl shadow border flex flex-col justify-center">
                    <h3 class="text-md font-black text-slate-500 text-center uppercase tracking-widest mb-4">週期損益表</h3>
                    <div id="periodStatsBanner"></div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="bg-white p-4 rounded-3xl shadow border pie-container">
                    <h4 class="text-center font-bold text-slate-600 mb-2 text-sm">年度 收支比</h4>
                    <div class="chart-box"><canvas id="chartYearRatio"></canvas></div>
                </div>
                <div class="bg-white p-4 rounded-3xl shadow border pie-container">
                    <h4 class="text-center font-bold text-slate-600 mb-2 text-sm">年度 成本結構</h4>
                    <div class="chart-box"><canvas id="chartYearCost"></canvas></div>
                </div>
                <div class="bg-white p-4 rounded-3xl shadow border pie-container">
                    <h4 class="text-center font-bold text-slate-600 mb-2 text-sm">本月 收支比</h4>
                    <div class="chart-box"><canvas id="chartMonthRatio"></canvas></div>
                </div>
                <div class="bg-white p-4 rounded-3xl shadow border pie-container">
                    <h4 class="text-center font-bold text-slate-600 mb-2 text-sm">本月 成本結構</h4>
                    <div class="chart-box"><canvas id="chartMonthCost"></canvas></div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>